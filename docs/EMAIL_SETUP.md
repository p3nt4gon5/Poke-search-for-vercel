# Email Notifications Setup Guide

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–∫–µ–º–æ–Ω–æ–≤ –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–µ–º–æ–Ω–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–∞—é—Ç:

- –ù–∞–∑–≤–∞–Ω–∏–µ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–∫–µ–º–æ–Ω–∞
- –ö–ª–∏–∫–∞–±–µ–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∫–µ–º–æ–Ω–∞
- –ö—Ä–∞—Å–∏–≤—ã–π HTML –¥–∏–∑–∞–π–Ω
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ø–∏—Å–∫–∏ –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SendGrid

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ SendGrid

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [sendgrid.com](https://sendgrid.com)
2. –°–æ–∑–¥–∞–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç (100 –ø–∏—Å–µ–º –≤ –¥–µ–Ω—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ email –∞–¥—Ä–µ—Å

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞

1. –í –ø–∞–Ω–µ–ª–∏ SendGrid –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **API Keys**
2. –ù–∞–∂–º–∏—Ç–µ **Create API Key**
3. –í—ã–±–µ—Ä–∏—Ç–µ **Full Access** –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ API –∫–ª—é—á (–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Sender Authentication**
2. –í—ã–±–µ—Ä–∏—Ç–µ **Single Sender Verification** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
3. –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ **Domain Authentication** –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í –ø–∞–Ω–µ–ª–∏ Supabase –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Edge Functions** –∏ –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
SENDGRID_API_KEY=your_sendgrid_api_key_here
FROM_EMAIL=noreply@yourdomain.com
SITE_URL=https://yourdomain.com
```

### 2. –í–∫–ª—é—á–µ–Ω–∏–µ pg_net —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Database** ‚Üí **Extensions**
2. –ù–∞–π–¥–∏—Ç–µ –∏ –≤–∫–ª—é—á–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `pg_net`
3. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–í **Settings** ‚Üí **Database** ‚Üí **Configuration** –¥–æ–±–∞–≤—å—Ç–µ:

```sql
-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Edge Functions
ALTER DATABASE postgres SET "app.supabase_url" = 'https://your-project.supabase.co';
ALTER DATABASE postgres SET "app.supabase_service_role_key" = 'your_service_role_key';
```

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Edge Function

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Supabase CLI

```bash
npm install -g supabase
```

### 2. –õ–æ–≥–∏–Ω –∏ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
supabase login
supabase link --project-ref your-project-ref
```

### 3. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

```bash
supabase functions deploy send-pokemon-notification
```

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ç–∞–±–ª–∏—Ü –∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤:

```bash
supabase db push
```

–ò–ª–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é –≤ SQL Editor:

```sql
-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ 20250104000000_email_notifications_system.sql
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### 1. –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

1. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Email Notifications Manager**
3. –í–≤–µ–¥–∏—Ç–µ ID —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–∫–µ–º–æ–Ω–∞
4. –ù–∞–∂–º–∏—Ç–µ **Send Test**

### 2. –ß–µ—Ä–µ–∑ SQL

```sql
-- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–∫–µ–º–æ–Ω–∞ —Å ID 25 (Pikachu)
SELECT send_test_notification(25);
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–µ–º–æ–Ω–∞

–ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–µ–º–æ–Ω–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç:

1. –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ
2. –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ —Å—Å—ã–ª–∫—É –≤ –ø–∏—Å—å–º–µ
3. –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç:

1. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∏—Å–µ–º
2. –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã email

### Resend

```typescript
// –ó–∞–º–µ–Ω–∏—Ç–µ SendGrid API –Ω–∞ Resend
const response = await fetch('https://api.resend.com/emails', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${RESEND_API_KEY}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    from: 'noreply@yourdomain.com',
    to: [profile.email],
    subject: `üéâ New Pokemon Added: ${pokemonName}!`,
    html: emailHTML,
  }),
});
```

### Mailgun

```typescript
// –î–ª—è Mailgun
const formData = new FormData();
formData.append('from', FROM_EMAIL);
formData.append('to', profile.email);
formData.append('subject', `üéâ New Pokemon Added: ${pokemonName}!`);
formData.append('html', emailHTML);

const response = await fetch(`https://api.mailgun.net/v3/${MAILGUN_DOMAIN}/messages`, {
  method: 'POST',
  headers: {
    'Authorization': `Basic ${btoa(`api:${MAILGUN_API_KEY}`)}`,
  },
  body: formData,
});
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ Edge Function

```bash
supabase functions logs send-pokemon-notification
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏

–í—Å–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–∏—Å—å–º–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `email_notifications_log`:

```sql
SELECT 
  pokemon_name,
  email_status,
  email_sent_at,
  COUNT(*) as count
FROM email_notifications_log 
GROUP BY pokemon_name, email_status, email_sent_at
ORDER BY email_sent_at DESC;
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **"schema net does not exist"** - –í–∫–ª—é—á–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `pg_net`
2. **"Unauthorized"** - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. **"Function not found"** - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Edge Function —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞
4. **–ü–∏—Å—å–º–∞ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç** - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ spam –ø–∞–ø–∫—É –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–µ–Ω–∞

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –î–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—á–µ—Ä–µ–¥–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Supabase Realtime)
2. –û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø–∏—Å—å–º–∞ –±–∞—Ç—á–∞–º–∏
3. –î–æ–±–∞–≤—å—Ç–µ rate limiting
4. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ background jobs

### –ü—Ä–∏–º–µ—Ä —Å –æ—á–µ—Ä–µ–¥—å—é

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –æ—á–µ—Ä–µ–¥–∏
CREATE TABLE email_queue (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  pokemon_id integer NOT NULL,
  status text DEFAULT 'pending',
  created_at timestamptz DEFAULT now(),
  processed_at timestamptz
);

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
CREATE OR REPLACE FUNCTION queue_pokemon_notification()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO email_queue (pokemon_id) VALUES (NEW.id);
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ API –∫–ª—é—á–∏ –≤ –∫–æ–¥–µ**
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø—Ä–∞–≤–∞ API –∫–ª—é—á–µ–π**
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API**
5. **–î–æ–±–∞–≤—å—Ç–µ rate limiting –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ø–∞–º–∞**

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫—Ä–∞—Å–∏–≤—ã–µ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –ø–æ–∫–µ–º–æ–Ω–æ–≤. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏, –∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã - –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã.